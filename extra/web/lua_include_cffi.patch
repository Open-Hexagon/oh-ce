--- a/libs/lua-5.1.5/src/linit.c
+++ b/libs/lua-5.1.5/src/linit.c
@@ -13,6 +13,7 @@
 #include "lualib.h"
 #include "lauxlib.h"

+#include "compat-5.3.h"

 static const luaL_Reg lualibs[] = {
   {"", luaopen_base},
@@ -26,6 +27,7 @@ static const luaL_Reg lualibs[] = {
   {NULL, NULL}
 };

+int luaopen_cffi(lua_State *L);

 LUALIB_API void luaL_openlibs (lua_State *L) {
   const luaL_Reg *lib = lualibs;
@@ -34,5 +36,6 @@ LUALIB_API void luaL_openlibs (lua_State *L) {
     lua_pushstring(L, lib->name);
     lua_call(L, 1, 0);
   }
+  luaL_requiref( L, "ffi", luaopen_cffi, 0 );
 }
